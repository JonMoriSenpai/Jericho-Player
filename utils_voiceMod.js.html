<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: utils/voiceMod.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/nav.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/skyceil.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
</head>

<body>

<nav class="navbar">
    <h4><a href="index.html">Home</a></h4><h5 class="no-bottom must-underline">Classes</h5><ul><li><span class="small-icon C">C</span><b><a href="downloader.html">downloader</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="downloader.html#eventEmitter">eventEmitter</a></li><li><span class="small-icon M">M</span><a href="downloader.html#options">options</a></li><li><span class="small-icon M">M</span><a href="downloader.html#packet">packet</a></li><li><span class="small-icon M">M</span><a href="downloader.html#playdl">playdl</a></li><li><span class="small-icon M">M</span><a href="downloader.html#player">player</a></li><li><span class="small-icon M">M</span><a href="downloader.html#queue">queue</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="packets.html">packets</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="packets.html#__privateCaches">__privateCaches</a></li><li><span class="small-icon M">M</span><a href="packets.html#audioPlayer">audioPlayer</a></li><li><span class="small-icon M">M</span><a href="packets.html#destroyed">destroyed</a></li><li><span class="small-icon M">M</span><a href="packets.html#downloader">downloader</a></li><li><span class="small-icon M">M</span><a href="packets.html#eventEmitter">eventEmitter</a></li><li><span class="small-icon M">M</span><a href="packets.html#guildId">guildId</a></li><li><span class="small-icon M">M</span><a href="packets.html#options">options</a></li><li><span class="small-icon M">M</span><a href="packets.html#player">player</a></li><li><span class="small-icon M">M</span><a href="packets.html#queue">queue</a></li><li><span class="small-icon M">M</span><a href="packets.html#tracksMetadata">tracksMetadata</a></li><li><span class="small-icon M">M</span><a href="packets.html#type">type</a></li><li><span class="small-icon M">M</span><a href="packets.html#voiceMod">voiceMod</a></li></ul></li><li><span class="small-icon C">C</span><a href="player%2520-_%2520Player%2520Class%2520for%2520Discord%2520Client%2520v14%2520for%2520Jericho-Player%2520Framework.html">player -> Player Class for Discord Client v14 for Jericho-Player Framework</a></li><li><span class="small-icon C">C</span><b><a href="queue.html">queue</a></b><ul class="has-class-methods"><li><span class="small-icon F">F</span><a href="queue.html#clear">clear</a></li><li><span class="small-icon M">M</span><a href="queue.html#current">current</a></li><li><span class="small-icon M">M</span><a href="queue.html#destroyed">destroyed</a></li><li><span class="small-icon M">M</span><a href="queue.html#discordClient">discordClient</a></li><li><span class="small-icon M">M</span><a href="queue.html#eventEmitter">eventEmitter</a></li><li><span class="small-icon M">M</span><a href="queue.html#guildId">guildId</a></li><li><span class="small-icon M">M</span><a href="queue.html#options">options</a></li><li><span class="small-icon M">M</span><a href="queue.html#packet">packet</a></li><li><span class="small-icon M">M</span><a href="queue.html#paused">paused</a></li><li><span class="small-icon M">M</span><a href="queue.html#player">player</a></li><li><span class="small-icon M">M</span><a href="queue.html#playing">playing</a></li><li><span class="small-icon M">M</span><a href="queue.html#previousTrack">previousTrack</a></li><li><span class="small-icon M">M</span><a href="queue.html#previousTracks">previousTracks</a></li><li><span class="small-icon M">M</span><a href="queue.html#tracks">tracks</a></li><li><span class="small-icon M">M</span><a href="queue.html#voiceConnection">voiceConnection</a></li><li><span class="small-icon M">M</span><a href="queue.html#voiceMod">voiceMod</a></li><li><span class="small-icon M">M</span><a href="queue.html#volume">volume</a></li><li><span class="small-icon M">M</span><a href="queue.html#working">working</a></li></ul></li><li><span class="small-icon C">C</span><a href="voiceMod.html">voiceMod</a></li></ul><h4>Global</h4><ul><li><a href="global.html#__cacheAndCleanTracksCacheandCleanTracksonTrackEndeventTrigger/Requirement">__cacheAndCleanTracks Cache and Clean Tracks on Track End event Trigger/Requirement</a></li><li><a href="global.html#__perfectCleanPerfectcleanforavoidingMemoryleakandreleasethetidewithRAMusuage">__perfectClean Perfect clean for avoiding Memory leak and release the tide with RAM usuage</a></li><li><a href="global.html#__playlistModPlaylistModeratorforeventsandparsingrawPlaylist/AlbumData">__playlistMod Playlist Moderator for events and parsing raw Playlist/Album Data</a></li><li><a href="global.html#__queryFilterQueryFilterfortheSongUrlschecks">__queryFilter Query Filter for the Song Urls checks</a></li><li><a href="global.html#__trackMovementManagerTrackMovementAudioResourceandFetchingProperly">__trackMovementManager Track Movement Audio Resource and Fetching Properly</a></li><li><a href="global.html#__tracksModTracksModeratorforeventsandparsingrawTracksDatafromdefaultextractors">__tracksMod Tracks Moderator for events and parsing raw Tracks Data from default extractors</a></li><li><a href="global.html#backBackMethodfortheQueue">back Back Method for the Queue</a></li><li><a href="global.html#createQueueCreationofQueueInstancewithpropercachingandOptionsformulator">createQueue Creation of Queue Instance with proper caching and Options formulator</a></li><li><a href="global.html#depReportDependenciesReportasStringfromthemiscUtils">depReport Dependencies Report as String from the misc Utils</a></li><li><a href="global.html#destroyDestroypacketandinternalworkingsofqueueregister/cachesandwithacompleteclearenceandevenclearbackendcachestoremoveallconnectionsfromeveryrequestorhandlersifany">destroy Destroy packet and internal workings of queue register/caches and with a complete clearence and even clear backend caches to remove all connections from every request or handlers </a></li><li><a href="global.html#destroyQueueDestroyQueuefromPlayerCachesanddestroyQueueinternallyifanyprocessarerunningoronwait">destroyQueue Destroy Queue from Player Caches and destroy Queue internally </a></li><li><a href="global.html#getGetTracksDataortriggeringtrackeventforTracksMod">get Get Tracks Data or triggering track event for Tracks Mod</a></li><li><a href="global.html#getPlaydlPlay-dlextractorFunctionwithrepsecttointernalfunctionstosupportthecauseofusage">getPlaydl Play-dl extractor Function with repsect to internal functions to support the cause of usage</a></li><li><a href="global.html#getQueryFetchingTracksDataandPlaylistDataRequestfromextractorsusingdownloaderclass">getQuery Fetching Tracks Data and Playlist Data Request from extractors using downloader class</a></li><li><a href="global.html#getQueueFetching/GettingofQueueInstancewithpropercachingandOptionsformulator">getQueue Fetching/Getting of Queue Instance with proper caching and Options formulator</a></li><li><a href="global.html#getYoutubedlYoutube-dlextractorFunctionwithrepsecttointernalfunctionstosupportthecauseofusage">getYoutubedl Youtube-dl extractor Function with repsect to internal functions to support the cause of usage</a></li><li><a href="global.html#muteMutetheMusicPlayeroftheQueue">mute Mute the Music Player of the Queue</a></li><li><a href="global.html#pausePauseAudioPlayeroftheQueue">pause Pause Audio Player of the Queue</a></li><li><a href="global.html#playPlayMethodofQueueClasstoplayrawQueryInfoafterprocessingandfetchfromwebusingextractors">play Play Method of Queue Class to play raw Query Info after processing and fetch from web using extractors</a></li><li><a href="global.html#setVolumeSettingVolumeoftheAudioPlayer">setVolume Setting Volume of the Audio Player</a></li><li><a href="global.html#shuffleShuffleMethodfortheQueue">shuffle Shuffle Method for the Queue</a></li><li><a href="global.html#skipSkippingCurrentTracktospecifiedTrack-Countsorby-defaultonnextsong">skip Skipping Current Track to specified Track-Counts or by-default on next song</a></li><li><a href="global.html#stopStoppingCurrentTrackalongsidewithQueuetoacompletesilencewithcleaning">stop Stopping Current Track along side with Queue to a complete silence with cleaning</a></li><li><a href="global.html#unmuteUn-MutetheMusicPlayeroftheQueue">unmute Un-Mute the Music Player of the Queue</a></li><li><a href="global.html#unpauseUn-PauseAudioPlayeroftheQueue">unpause Un-Pause Audio Player of the Queue</a></li></ul>
</nav>

<div id="main">
    <div class="burger">
        <div class="burger-line-1"></div>
        <div class="burger-line-2"></div>
        <div class="burger-line-3"></div>
    </div>

    <h1 class="page-title">Source: utils/voiceMod.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const {
  joinVoiceChannel,
  VoiceConnectionStatus,
  entersState,
  getVoiceConnection,
} = require('@discordjs/voice');
const { voiceResolver, guildResolver } = require('./snowflakes');
const queue = require('../core/queue');
const { invalidVoiceChannel } = require('../misc/errorEvents');
const { voiceOptions } = require('../misc/enums');

class voiceMod {
  /**
   * @constructor
   * @param {queue} queue
   * @param {voiceOptions} options
   */
  constructor(queue, options = voiceOptions) {
    this.queue = queue;
    this.player = queue?.player;
    this.discordClient = queue?.discordClient;
    this.eventEmitter = queue?.eventEmitter;
    this.options = options;
  }

  async connect(
    voiceSnowflake,
    requestedSource = this.queue?.current?.requestedSource,
  ) {
    try {
      const voiceChannel = await voiceResolver(
        this.discordClient,
        voiceSnowflake,
      );
      if (!voiceChannel)
        throw new invalidVoiceChannel(
          'Wrong Voice Channel Snowflake/Resolve is Detected for voiceMod.connect()',
        );
      if (this.queue.destroyed &amp;&amp; typeof this.queue?.destroyed !== 'boolean')
        clearTimeout(this.queue?.destroyed);
      const rawVoiceConnection = joinVoiceChannel({
        channelId: voiceChannel?.id,
        guildId: voiceChannel?.guildId,
        adapterCreator: voiceChannel?.guild?.voiceAdapterCreator,
      });
      try {
        await entersState(
          rawVoiceConnection,
          VoiceConnectionStatus.Ready,
          60e3,
        );
        return rawVoiceConnection;
      } catch (errorMetadata) {
        rawVoiceConnection.destroy();
        throw errorMetadata;
      }
    } catch (errorMetadata) {
      this.eventEmitter.emitEvent(
        'connectionError',
        errorMetadata?.message ?? `${errorMetadata}`,
        { queue: this.queue, requestedSource },
        this.options?.eventOptions,
      );
      return undefined;
    }
  }

  async disconnect(
    guildSnowflake,
    delayVoiceTimeout,
    requestedSource = this.queue?.current?.requestedSource,
    options = this.options ?? voiceOptions,
  ) {
    try {
      const guild = await guildResolver(this.discordClient, guildSnowflake);
      if (!guild)
        throw new invalidVoiceChannel(
          'Wrong Voice Channel Snowflake/Resolve is Detected for voiceMod.connect()',
        );
      const queue = await this.player.getQueue(guild);
      if (queue.destroyed &amp;&amp; typeof queue?.destroyed !== 'boolean')
        clearTimeout(this.queue?.destroyed);
      if (queue?.packet?.audioPlayer &amp;&amp; (queue?.playing || queue?.paused))
        queue?.packet?.audioPlayer?.stop();
      if (
        queue?.packet?.__privateCaches?.audioPlayerSubscription &amp;&amp;
        (queue?.playing || queue?.paused)
      ) {
        queue.packet.__privateCaches.audioPlayerSubscription.unsubscribe();
        queue.packet.__privateCaches.audioPlayerSubscription = undefined;
      }
      const connectedChannel = await voiceResolver(
        this.discordClient,
        options?.altVoiceChannel ?? guild?.members?.me?.voice?.channel,
      );
      if (!connectedChannel) return undefined;
      else if (options?.forceDestroy)
        if (delayVoiceTimeout &amp;&amp; delayVoiceTimeout > 0) {
          return setTimeout(() => {
            const voiceConnection = getVoiceConnection(guild?.id);
            if (!voiceConnection) return undefined;
            voiceConnection.destroy(true);
            this.eventEmitter.emitEvent(
              'botDisconnect',
              'Discord Client got Disconnected from the Channel',
              {
                queue: this.queue,
                channel: connectedChannel,
                requestedSource,
              },
            );
            return true;
          }, delayVoiceTimeout * 1000);
        } else {
          const voiceConnection = getVoiceConnection(guild?.id);
          if (!voiceConnection) return undefined;
          voiceConnection.destroy(true);
          this.eventEmitter.emitEvent(
            'botDisconnect',
            'Discord Client got Disconnected from the Channel',
            {
              queue: this.queue,
              channel: connectedChannel,
              requestedSource,
            },
          );
          return true;
        }
      else if (delayVoiceTimeout &amp;&amp; delayVoiceTimeout > 0) {
        return setTimeout(() => {
          const voiceConnection = getVoiceConnection(guild?.id);
          if (!voiceConnection) return undefined;
          voiceConnection.disconnect();
          this.eventEmitter.emitEvent(
            'botDisconnect',
            'Discord Client got Disconnected from the Channel',
            {
              queue: this.queue,
              channel: connectedChannel,
              requestedSource,
            },
          );
          return true;
        }, delayVoiceTimeout * 1000);
      } else {
        const voiceConnection = getVoiceConnection(guild?.id);
        if (!voiceConnection) return undefined;
        voiceConnection.disconnect();
        this.eventEmitter.emitEvent(
          'botDisconnect',
          'Discord Client got Disconnected from the Channel',
          {
            queue: this.queue,
            channel: connectedChannel,
            requestedSource,
          },
        );
        return true;
      }
    } catch (errorMetadata) {
      this.eventEmitter.emitEvent(
        'connectionError',
        errorMetadata?.message ?? `${errorMetadata}`,
        { queue: this.queue, requestedSource },
        this.options?.eventOptions,
      );
      return undefined;
    }
  }
}

module.exports = voiceMod;
</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu Aug 18 2022 20:42:57 GMT+0000 (Coordinated Universal Time) using <a href="https://github.com/zyrouge/jsdoc-skyceil">Skyceil Theme</a>
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

</body>
</html>
