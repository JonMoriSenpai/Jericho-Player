<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Structures/Tracks.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ClassUtils.html">ClassUtils</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.__SearchPackageJson">__SearchPackageJson</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.__versioning">__versioning</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.HumanTimeConversion">HumanTimeConversion</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.ScanDeps">ScanDeps</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.stablizingoptions">stablizingoptions</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="JerichoPlayer.html">JerichoPlayer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#.QueueCacheAdd">QueueCacheAdd</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#.QueueCacheFetch">QueueCacheFetch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#.QueueCacheRemove">QueueCacheRemove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#CreateQueue">CreateQueue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#DeleteQueue">DeleteQueue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#GetQueue">GetQueue</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Queue.html">Queue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#autoplay">autoplay</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#back">back</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#createProgressBar">createProgressBar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#insert">insert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#loop">loop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#mute">mute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#pause">pause</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#play">play</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#repeat">repeat</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#resume">resume</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#search">search</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#skip">skip</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#stop">stop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#unmute">unmute</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="StreamPacketGen.html">StreamPacketGen</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#__handleMusicPlayerModes">__handleMusicPlayerModes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#back">back</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#insert">insert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#setMode">setMode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#StreamAudioResourceExtractor">StreamAudioResourceExtractor</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TrackGenerator.html">TrackGenerator</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.fetch">fetch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.PlayDLExtractor">PlayDLExtractor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.SongsFetching">SongsFetching</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.Track_Id_Placement">Track_Id_Placement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.UserTrackModelGen">UserTrackModelGen</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.YoutubeDLExtractor">YoutubeDLExtractor</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VoiceUtils.html">VoiceUtils</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VoiceUtils.html#.disconnect">disconnect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VoiceUtils.html#.join">join</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">Structures/Tracks.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const ClassUtils = require('../Utilities/Class-Utils');
const {
  DefaultExtractorStreamOptions,
  DefaultChunk,
  DefaultStream,
  DefaultTrack,
  DefaultFetchOptions,
  DefaultExtractorData,
} = require('../types/interfaces');

/**
 * @private
 * @class TrackGenerator -> these class helps to genreate Tracks from Query and Stream options using methods
 * Tracks sometimes went wrong if Query doesn't match or Ratelimited and error event will trigger
 */
class TrackGenerator {
  /**
   * fetch() -> Fetch method , fetches Streams for Stream packet
   * @param {String} Query Query like URls or Youtube Searches | Default Extractor accept 5 supported and big websites like youtube , spotify , soundcloud , retribution , facebook and for "youtube-dl" , it accept any follows official "youtube" searches
   * @param {User|GuildMember|undefined} requestedBy user Data as who requested if given during insert or play method of Queue Instance
   * @param {DefaultExtractorStreamOptions} FetchOptions Extractor Options for Track Download from Extractors
   * @param {String|Boolean|undefined} extractor extractor to be used as "play-dl" or "youtube-dl"
   * @param {Nummber|String|undefined} CacheLength Last Track ID value
   * @param {Boolean|undefined} NoStreamif Check if User wants Stream or not
   * @returns {Promise&lt;DefaultChunk>} returns Chunk value | like a packet of tracks and streamdata values
   */
  static async fetch(
    Query,
    requestedBy = undefined,
    FetchOptions = {
      IgnoreError: true,
      ExtractorStreamOptions: {
        Limit: 1,
        Quality: 'high',
        Cookies: undefined,
        ByPassYoutubeDLRatelimit: true,
        YoutubeDLCookiesFilePath: undefined,
        Proxy: undefined,
      },
      NoStreamif: false,
    },
    extractor = 'play-dl',
    CacheLength = 0,
  ) {
    FetchOptions.ExtractorStreamOptions = ClassUtils.stablizingoptions(
      FetchOptions.ExtractorStreamOptions,
      DefaultExtractorStreamOptions,
    );
    if (!Query || (Query &amp;&amp; typeof Query !== 'string')) {
      return {
        playlist: false,
        streamdatas: [],
        tracks: [],
        error: 'Invalid Query',
      };
    }
    if (
      !ClassUtils.ScanDeps('playdl-music-extractor')
      &amp;&amp; !ClassUtils.ScanDeps('video-extractor')
    ) {
      return {
        playlist: false,
        streamdatas: [],
        tracks: [],
        error:
          '\'Extractors : "playdl-music-extractor" and "video-extractor" are not Present , Use "Utils.ScanDeps()" to See and Do - "npm i packageName"',
      };
    }
    const RawData = await TrackGenerator.SongsFetching(
      Query,
      FetchOptions,
      extractor,
    );
    if (
      !RawData
      || (RawData &amp;&amp; !RawData.tracks)
      || (RawData &amp;&amp; RawData.tracks &amp;&amp; !RawData.tracks[0])
    ) {
      return {
        playlist: false,
        streamdatas: [],
        tracks: [],
        error:
          (RawData.error &amp;&amp; RawData.error.message
            ? RawData.error ?? RawData.error.message
            : undefined)
          ?? (RawData.error &amp;&amp; RawData.error[0] ? RawData.error[0] : undefined)
          ?? 'Search Not Found',
      };
    }
    const Chunks = TrackGenerator.Track_Id_Placement(
      RawData.tracks,
      CacheLength,
      requestedBy,
    );
    return {
      playlist: RawData.playlist,
      streamdatas: Chunks.streamdatas,
      tracks: Chunks.tracks,
      error: undefined,
    };
  }

  /**
   * @private Track_Id_Placement -> Track Placement in Tracks Cache with Differing as stream tracks and normal tracks for users
   * @param {DefaultStream[]} Tracks Stream Tracks to be converted User fetchable
   * @param {Number|undefined} CacheLength last Cached Track's ID
   * @param {User|GuildMember|undefined} requestedBy RequestedBy User Object value for Track
   * @returns {DefaultChunk} Chunk Vlaue for Tracks Cache
   */

  static Track_Id_Placement(Tracks, CacheLength, requestedBy = undefined) {
    const StreamDatas = [];
    const SearchTracks = [];
    for (let count = 0, len = Tracks.length; count &lt; len; ++count) {
      Tracks[count] ? (Tracks[count].Id = ++CacheLength) : undefined;
      Tracks[count]
        ? SearchTracks.push(
          TrackGenerator.UserTrackModelGen(Tracks[count], requestedBy),
        )
        : undefined;
      Tracks[count] ? StreamDatas.push(Tracks[count]) : undefined;
    }
    return {
      streamdatas: StreamDatas[0] ? StreamDatas : [],
      tracks: SearchTracks[0] ? SearchTracks : [],
    };
  }

  /**
   * SongsFetching() -> Raw Track Data Fetching from various extractors like "play-dl" | "youtube-dl"
   * @param {String} Query Query like URls or Youtube Searches | Default Extractor accept 5 supported and big websites like youtube , spotify , soundcloud , retribution , facebook and for "youtube-dl" , it accept any follows official "youtube" searches
   * @param {DefaultFetchOptions} FetchOptions Fetching Options for Extractors
   * @param {String|Boolean|undefined} extractor extractor to be used as "play-dl" or "youtube-dl"
   * @returns {Promise&lt;DefaultExtractorData>} Returns Extractor Value with no edits
   */

  static async SongsFetching(
    Query,
    FetchOptions = {
      IgnoreError: true,
      ExtractorStreamOptions: {
        Limit: 1,
        Quality: 'high',
        Cookies: undefined,
        ByPassYoutubeDLRatelimit: true,
        YoutubeDLCookiesFilePath: undefined,
        Proxy: undefined,
      },
      NoStreamif: false,
    },
    extractor = 'play-dl',
  ) {
    let RawData = extractor
      &amp;&amp; extractor.includes('youtube-dl')
      &amp;&amp; ClassUtils.ScanDeps('video-extractor')
      ? await TrackGenerator.YoutubeDLExtractor(
        Query,
        FetchOptions.ExtractorStreamOptions,
        FetchOptions.NoStreamif,
      )
      : undefined;
    RawData = !RawData
      || (RawData &amp;&amp; !RawData.tracks)
      || (RawData &amp;&amp; RawData.tracks &amp;&amp; !RawData.tracks[0])
      ? ClassUtils.ScanDeps('playdl-music-extractor')
        ? await TrackGenerator.PlayDLExtractor(
          Query,
          FetchOptions.ExtractorStreamOptions,
          FetchOptions.NoStreamif,
        )
        : { playlist: false, tracks: [], error: RawData.error }
      : undefined;
    RawData = !RawData
      || (RawData &amp;&amp; !RawData.tracks)
      || (RawData &amp;&amp; RawData.tracks &amp;&amp; !RawData.tracks[0])
      ? ClassUtils.ScanDeps('video-extractor')
        ? await TrackGenerator.YoutubeDLExtractor(
          Query,
          FetchOptions.ExtractorStreamOptions,
          FetchOptions.NoStreamif,
        )
        : { playlist: false, tracks: [], error: RawData.error }
      : RawData;
    return RawData;
  }

  /**
   * @private YoutubeDLExtractor -> Youtube-Dl Extractor for player
   * @param {String} Query Query like URls or Youtube Searches | Default Extractor accept 5 supported and big websites like youtube , spotify , soundcloud , retribution , facebook and for "youtube-dl" , it accept any follows official "youtube" searches
   * @param {DefaultExtractorStreamOptions} ExtractorStreamOptions Extractor Fetching Options
   * @param {Boolean|undefined} NoStreamif Check if User wants Stream or not
   * @returns {Promise&lt;DefaultExtractorData>} Returns Extractor Value with no edits
   */

  static async YoutubeDLExtractor(Query, ExtractorStreamOptions, NoStreamif) {
    const { StreamDownloader, Extractor } = require('video-extractor');
    if (NoStreamif) {
      return await Extractor(Query, {
        Proxy:
          typeof ExtractorStreamOptions.Proxy === 'object'
            ? ExtractorStreamOptions.Proxy[0]
            : undefined,
        YTCookies: ExtractorStreamOptions.Cookies,
        BypassRatelimit:
          ExtractorStreamOptions.ByPassYoutubeDLRatelimit ?? undefined,
        YoutubeDLCookiesFilePath:
          ExtractorStreamOptions.YoutubeDLCookiesFilePath,
      });
    }
    return await StreamDownloader(Query, {
      Proxy:
        typeof ExtractorStreamOptions.Proxy === 'object'
          ? ExtractorStreamOptions.Proxy[0]
          : undefined,
      YTCookies: ExtractorStreamOptions.Cookies,
      BypassRatelimit:
        ExtractorStreamOptions.ByPassYoutubeDLRatelimit ?? undefined,
      YoutubeDLCookiesFilePath: ExtractorStreamOptions.YoutubeDLCookiesFilePath,
    });
  }

  /**
   * @private PlayDLExtractor -> Play-Dl Extractor for player
   * @param {String} Query Query like URls or Youtube Searches | Default Extractor accept 5 supported and big websites like youtube , spotify , soundcloud , retribution , facebook and for "youtube-dl" , it accept any follows official "youtube" searches
   * @param {DefaultExtractorStreamOptions} ExtractorStreamOptions Extractor Fetching Options
   * @param {Boolean|undefined} NoStreamif Check if User wants Stream or not
   * @returns {Promise&lt;DefaultExtractorData>} Returns Extractor Value with no edits
   */

  static async PlayDLExtractor(Query, ExtractorStreamOptions, NoStreamif) {
    const { StreamDownloader, Extractor } = require('playdl-music-extractor');
    if (NoStreamif) {
      return await Extractor(Query, ExtractorStreamOptions);
    }
    return await StreamDownloader(Query, ExtractorStreamOptions);
  }

  /**
   * @private UserTrackModelGen -> Transfering Normal Stream Data to user readable Track
   * @param {DefaultStream} TrackData Stream Data about the Track
   * @param {User|GuildMember|undefined} requestedByUser Requested user for Track Object
   * @returns {DefaultTrack} Track Value for Queue.tracks[]
   */

  static UserTrackModelGen(TrackData, requestedByUser) {
    return {
      Id: TrackData.Id,
      requestedBy: requestedByUser,
      url: TrackData.url,
      video_Id: TrackData.video_Id,
      title: TrackData.title,
      description: TrackData.description,
      duration: TrackData.stream_duration,
      human_duration: TrackData.stream_human_duration,
      thumbnail: TrackData.thumbnail,
      channelId: TrackData.author ?? TrackData.channelId,
      channel_url: TrackData.author_link ?? TrackData.channel_url,
      likes: TrackData.likes,
      is_live: TrackData.is_live,
      dislikes: TrackData.dislikes,
    };
  }
}

module.exports = TrackGenerator;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Sat Nov 06 2021 13:39:09 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
