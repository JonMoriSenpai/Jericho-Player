<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Utilities/Voice-Utils.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ClassUtils.html">ClassUtils</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.__SearchPackageJson">__SearchPackageJson</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.__versioning">__versioning</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.HumanTimeConversion">HumanTimeConversion</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.ScanDeps">ScanDeps</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClassUtils.html#.stablizingoptions">stablizingoptions</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="JerichoPlayer.html">JerichoPlayer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#.QueueCacheAdd">QueueCacheAdd</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#.QueueCacheFetch">QueueCacheFetch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#.QueueCacheRemove">QueueCacheRemove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#CreateQueue">CreateQueue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#DeleteQueue">DeleteQueue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="JerichoPlayer.html#GetQueue">GetQueue</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Queue.html">Queue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#autoplay">autoplay</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#back">back</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#createProgressBar">createProgressBar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#insert">insert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#loop">loop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#mute">mute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#pause">pause</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#play">play</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#repeat">repeat</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#resume">resume</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#search">search</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#skip">skip</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#stop">stop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Queue.html#unmute">unmute</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="StreamPacketGen.html">StreamPacketGen</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#__handleMusicPlayerModes">__handleMusicPlayerModes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#back">back</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#insert">insert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#setMode">setMode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StreamPacketGen.html#StreamAudioResourceExtractor">StreamAudioResourceExtractor</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TrackGenerator.html">TrackGenerator</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.fetch">fetch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.PlayDLExtractor">PlayDLExtractor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.SongsFetching">SongsFetching</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.Track_Id_Placement">Track_Id_Placement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.UserTrackModelGen">UserTrackModelGen</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TrackGenerator.html#.YoutubeDLExtractor">YoutubeDLExtractor</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VoiceUtils.html">VoiceUtils</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VoiceUtils.html#.disconnect">disconnect</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="VoiceUtils.html#.join">join</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">Utilities/Voice-Utils.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const {
  joinVoiceChannel,
  getVoiceConnection,
  VoiceConnectionStatus,
  entersState,
  VoiceConnection,
} = require('@discordjs/voice');
const { Client, VoiceChannel, StageChannel } = require('discord.js');
const {
  DefaultDisconnectChannelOptions,
  DefaultJoinChannelOptions,
} = require('../types/interfaces');

class VoiceUtils {
  /**
   * @private
   */
  constructor() {}

  /**
   * Join Channel function for Voice Utils with Client and Channel and JoinChannelOptions Credentials
   * @param {Client} Client Discord Client Instance
   * @param {VoiceChannel|StageChannel} Channel Guild Voice Channel | Guild Stage Channel
   * @param {DefaultJoinChannelOptions|undefined} JoinChannelOptions Options for Joining Voice Channel
   * @returns {Promise&lt;VoiceConnection>|undefined} Returns Voice Connection Made by the
   */
  static async join(
    Client,
    Channel,
    JoinChannelOptions = {
      force: false,
    },
  ) {
    let VoiceConnection = getVoiceConnection(Channel.guild.id);
    if (
      VoiceConnection
      &amp;&amp; VoiceConnection.state
      &amp;&amp; VoiceConnection.state.status !== VoiceConnectionStatus.Destroyed
      &amp;&amp; VoiceConnection.state.status !== VoiceConnectionStatus.Disconnected
      &amp;&amp; !JoinChannelOptions.force
    ) { return VoiceConnection; }

    VoiceConnection = joinVoiceChannel({
      channelId: Channel.id,
      guildId: Channel.guild.id,
      adapterCreator: Channel.guild.voiceAdapterCreator,
    });
    await entersState(VoiceConnection, VoiceConnectionStatus.Ready, 30e3);
    Channel = Client.channels.cache.get(`${Channel.id}`)
      ?? (await Client.channels.fetch(`${Channel.id}`));
    if (
      Channel.guild.me
      &amp;&amp; Channel.guild.me.voice
      &amp;&amp; Channel.type === 'GUILD_STAGE_VOICE'
    ) {
      Channel.guild.me.voice
        .setSuppressed(false)
        .catch((err) => VoiceConnection);
      return VoiceConnection;
    }
    return VoiceConnection;
  }

  /**
   * Disconnect Voice Channel and even destroy Voice Connection if Option.destroy =? true
   * @param {String|Number} guildId Guild's id as Snowflake
   * @param {DefaultDisconnectChannelOptions|undefined} DisconnectChannelOptions Disconnect Options for Connection
   * @param {Number|String|undefined} Timedout Nodejs Timedout duration if delay has been issues
   * @param {Queue} QueueInstance Queue Instance for fetching Player and Stream Packet
   * @returns {undefined|Number|String} Returns Nodejs Timedout for Delays and undefined on completion or errors
   */

  static disconnect(
    guildId,
    DisconnectChannelOptions = {
      destroy: true,
    },
    Timedout = 0,
    QueueInstance = undefined,
  ) {
    if (Timedout &amp;&amp; Timedout > 0) {
      return setTimeout(() => {
        const VoiceConnection = getVoiceConnection(guildId);
        if (
          VoiceConnection
          &amp;&amp; DisconnectChannelOptions
          &amp;&amp; DisconnectChannelOptions.destroy
        ) {
          if (QueueInstance &amp;&amp; !QueueInstance.destroyed) {
            QueueInstance.MusicPlayer.stop();
            QueueInstance.StreamPacket.subscription
              ? QueueInstance.StreamPacket.subscription.unsubscribe()
              : undefined;
          }
          return void VoiceConnection.destroy(true);
        }
        if (VoiceConnection) {
          if (QueueInstance &amp;&amp; !QueueInstance.destroyed) {
            QueueInstance.MusicPlayer.stop();
            QueueInstance.StreamPacket.subscription
              ? QueueInstance.StreamPacket.subscription.unsubscribe()
              : undefined;
          }
          return void VoiceConnection.disconnect();
        }
        return void QueueInstance.JerichoPlayer.emit(
          'connectionError',
          "Voice Connection Can't be destroyed",
          QueueInstance.JerichoPlayer.GetQueue(QueueInstance.guildId),
          VoiceConnection,
          guildId,
        );
      }, Number(Timedout) * 1000);
    }
    const VoiceConnection = getVoiceConnection(guildId);
    if (
      VoiceConnection
      &amp;&amp; DisconnectChannelOptions
      &amp;&amp; DisconnectChannelOptions.destroy
    ) {
      if (QueueInstance &amp;&amp; !QueueInstance.destroyed) {
        QueueInstance.MusicPlayer.stop();
        QueueInstance.StreamPacket.subscription
          ? QueueInstance.StreamPacket.subscription.unsubscribe()
          : undefined;
      }
      return void VoiceConnection.destroy(true);
    }
    if (VoiceConnection) {
      if (QueueInstance &amp;&amp; !QueueInstance.destroyed) {
        QueueInstance.MusicPlayer.stop();
        QueueInstance.StreamPacket.subscription
          ? QueueInstance.StreamPacket.subscription.unsubscribe()
          : undefined;
      }
      return void VoiceConnection.disconnect();
    }
    return void QueueInstance.JerichoPlayer.emit(
      'connectionError',
      "Voice Connection Can't be destroyed",
      QueueInstance.JerichoPlayer.GetQueue(QueueInstance.guildId),
      VoiceConnection,
      guildId,
    );
  }
}

module.exports = VoiceUtils;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Sat Nov 06 2021 13:39:09 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
