<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: utils/miscUtils.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/nav.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/skyceil.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
</head>

<body>

<nav class="navbar">
    <h4><a href="index.html">Home</a></h4><h5 class="no-bottom must-underline">Classes</h5><ul><li><span class="small-icon C">C</span><b><a href="downloader.html">downloader</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="downloader.html#eventEmitter">eventEmitter</a></li><li><span class="small-icon M">M</span><a href="downloader.html#options">options</a></li><li><span class="small-icon M">M</span><a href="downloader.html#packet">packet</a></li><li><span class="small-icon M">M</span><a href="downloader.html#playdl">playdl</a></li><li><span class="small-icon M">M</span><a href="downloader.html#player">player</a></li><li><span class="small-icon M">M</span><a href="downloader.html#queue">queue</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="packets.html">packets</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="packets.html#__privateCaches">__privateCaches</a></li><li><span class="small-icon M">M</span><a href="packets.html#audioPlayer">audioPlayer</a></li><li><span class="small-icon M">M</span><a href="packets.html#destroyed">destroyed</a></li><li><span class="small-icon M">M</span><a href="packets.html#downloader">downloader</a></li><li><span class="small-icon M">M</span><a href="packets.html#eventEmitter">eventEmitter</a></li><li><span class="small-icon M">M</span><a href="packets.html#guildId">guildId</a></li><li><span class="small-icon M">M</span><a href="packets.html#options">options</a></li><li><span class="small-icon M">M</span><a href="packets.html#player">player</a></li><li><span class="small-icon M">M</span><a href="packets.html#queue">queue</a></li><li><span class="small-icon M">M</span><a href="packets.html#tracksMetadata">tracksMetadata</a></li><li><span class="small-icon M">M</span><a href="packets.html#type">type</a></li><li><span class="small-icon M">M</span><a href="packets.html#voiceMod">voiceMod</a></li></ul></li><li><span class="small-icon C">C</span><a href="player%2520-_%2520Player%2520Class%2520for%2520Discord%2520Client%2520v14%2520for%2520Jericho-Player%2520Framework.html">player -> Player Class for Discord Client v14 for Jericho-Player Framework</a></li><li><span class="small-icon C">C</span><b><a href="queue.html">queue</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="queue.html#current">current</a></li><li><span class="small-icon M">M</span><a href="queue.html#destroyed">destroyed</a></li><li><span class="small-icon M">M</span><a href="queue.html#discordClient">discordClient</a></li><li><span class="small-icon M">M</span><a href="queue.html#eventEmitter">eventEmitter</a></li><li><span class="small-icon M">M</span><a href="queue.html#guildId">guildId</a></li><li><span class="small-icon M">M</span><a href="queue.html#options">options</a></li><li><span class="small-icon M">M</span><a href="queue.html#packet">packet</a></li><li><span class="small-icon M">M</span><a href="queue.html#paused">paused</a></li><li><span class="small-icon M">M</span><a href="queue.html#player">player</a></li><li><span class="small-icon M">M</span><a href="queue.html#playing">playing</a></li><li><span class="small-icon M">M</span><a href="queue.html#tracks">tracks</a></li><li><span class="small-icon M">M</span><a href="queue.html#voiceMod">voiceMod</a></li><li><span class="small-icon M">M</span><a href="queue.html#volume">volume</a></li><li><span class="small-icon M">M</span><a href="queue.html#working">working</a></li></ul></li><li><span class="small-icon C">C</span><a href="voiceMod.html">voiceMod</a></li></ul><h4>Global</h4><ul><li><a href="global.html#__cacheAndCleanTracksCacheandCleanTracksonTrackEndeventTrigger/Requirement">__cacheAndCleanTracks Cache and Clean Tracks on Track End event Trigger/Requirement</a></li><li><a href="global.html#__perfectCleanPerfectcleanforavoidingMemoryleakandreleasethetidewithRAMusuage">__perfectClean Perfect clean for avoiding Memory leak and release the tide with RAM usuage</a></li><li><a href="global.html#__playlistModPlaylistModeratorforeventsandparsingrawPlaylist/AlbumData">__playlistMod Playlist Moderator for events and parsing raw Playlist/Album Data</a></li><li><a href="global.html#__queryFilterQueryFilterfortheSongUrlschecks">__queryFilter Query Filter for the Song Urls checks</a></li><li><a href="global.html#__trackMovementManagerTrackMovementAudioResourceandFetchingProperly">__trackMovementManager Track Movement Audio Resource and Fetching Properly</a></li><li><a href="global.html#__tracksModTracksModeratorforeventsandparsingrawTracksDatafromdefaultextractors">__tracksMod Tracks Moderator for events and parsing raw Tracks Data from default extractors</a></li><li><a href="global.html#createQueueCreationofQueueInstancewithpropercachingandOptionsformulator">createQueue Creation of Queue Instance with proper caching and Options formulator</a></li><li><a href="global.html#depReportDependenciesReportasStringfromthemiscUtils">depReport Dependencies Report as String from the misc Utils</a></li><li><a href="global.html#destroyDestroypacketandinternalworkingsofqueueregister/cachesandwithacompleteclearenceandevenclearbackendcachestoremoveallconnectionsfromeveryrequestorhandlersifany">destroy Destroy packet and internal workings of queue register/caches and with a complete clearence and even clear backend caches to remove all connections from every request or handlers </a></li><li><a href="global.html#destroyQueueDestroyQueuefromPlayerCachesanddestroyQueueinternallyifanyprocessarerunningoronwait">destroyQueue Destroy Queue from Player Caches and destroy Queue internally </a></li><li><a href="global.html#getGetTracksDataortriggeringtrackeventforTracksMod">get Get Tracks Data or triggering track event for Tracks Mod</a></li><li><a href="global.html#getPlaydlPlay-dlextractorFunctionwithrepsecttointernalfunctionstosupportthecauseofusage">getPlaydl Play-dl extractor Function with repsect to internal functions to support the cause of usage</a></li><li><a href="global.html#getQueryFetchingTracksDataandPlaylistDataRequestfromextractorsusingdownloaderclass">getQuery Fetching Tracks Data and Playlist Data Request from extractors using downloader class</a></li><li><a href="global.html#getQueueFetching/GettingofQueueInstancewithpropercachingandOptionsformulator">getQueue Fetching/Getting of Queue Instance with proper caching and Options formulator</a></li><li><a href="global.html#getYoutubedlYoutube-dlextractorFunctionwithrepsecttointernalfunctionstosupportthecauseofusage">getYoutubedl Youtube-dl extractor Function with repsect to internal functions to support the cause of usage</a></li><li><a href="global.html#muteMutetheMusicPlayeroftheQueue">mute Mute the Music Player of the Queue</a></li><li><a href="global.html#pausePauseAudioPlayeroftheQueue">pause Pause Audio Player of the Queue</a></li><li><a href="global.html#playPlayMethodofQueueClasstoplayrawQueryInfoafterprocessingandfetchfromwebusingextractors">play Play Method of Queue Class to play raw Query Info after processing and fetch from web using extractors</a></li><li><a href="global.html#setVolumeSettingVolumeoftheAudioPlayer">setVolume Setting Volume of the Audio Player</a></li><li><a href="global.html#skipSkippingCurrentTracktospecifiedTrack-Countsorby-defaultonnextsong">skip Skipping Current Track to specified Track-Counts or by-default on next song</a></li><li><a href="global.html#stopStoppingCurrentTrackalongsidewithQueuetoacompletesilencewithcleaning">stop Stopping Current Track along side with Queue to a complete silence with cleaning</a></li><li><a href="global.html#unmuteUn-MutetheMusicPlayeroftheQueue">unmute Un-Mute the Music Player of the Queue</a></li><li><a href="global.html#unpauseUn-PauseAudioPlayeroftheQueue">unpause Un-Pause Audio Player of the Queue</a></li></ul>
</nav>

<div id="main">
    <div class="burger">
        <div class="burger-line-1"></div>
        <div class="burger-line-2"></div>
        <div class="burger-line-3"></div>
    </div>

    <h1 class="page-title">Source: utils/miscUtils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { Client, IntentsBitField } = require('discord.js');
const { resolve, dirname } = require('path')
const { FFmpeg } = require('prism-media');

class miscUtils {
  /**
   * scanDeps() -> Scanning Dependencies in package.json or node_modules for package or versions list
   * @param {String|void} packageName Package name for publishing it versions in project
   * @returns {String|void} Publish Data which was requested for like checks and versions
   */

  static scanDeps(packageName) {
    if (!packageName) {
      const report = [];
      const addVersion = (name) => report.push(
        `- ${name}: ${miscUtils.__findPkgVersion(name) ?? 'not found'}`,
      );
      // general
      report.push('Core Dependencies');
      addVersion('@discordjs/voice');
      addVersion('prism-media');
      report.push('');

      // opus
      report.push('Opus Libraries');
      addVersion('@discordjs/opus');
      addVersion('opusscript');
      report.push('');

      // encryption
      report.push('Encryption Libraries');
      addVersion('sodium');
      addVersion('libsodium-wrappers');
      addVersion('tweetnacl');
      report.push('');

      // ffmpeg
      report.push('FFmpeg');
      try {
        const info = FFmpeg.getInfo();
        report.push(`- version: ${info.version}`);
        report.push(
          `- libopus: ${
            info.output.includes('--enable-libopus') ? 'yes' : 'no'
          }`,
        );
      } catch (err) {
        report.push('- not found');
      }
      addVersion('ffmpeg-static');
      report.push('');

      // Extractors
      report.push('Extractors');
      addVersion('playdl-music-extractor');
      addVersion('video-extractor');

      return ['-'.repeat(50), ...report, '-'.repeat(50)].join('\n');
    }
    return (
      miscUtils.__findPkgVersion(packageName) ??
      miscUtils.__findPkgVersion(packageName.toLowerCase().trim())
    );
  }

  /**
   * @private __findPkgVersion() -> Searching Versions of Packages
   * @param {String} name NPM Package Name
   * @returns {String|void} Returns Package Version
   */

  static __findPkgVersion(name) {
    try {
      const pkg =
        name === '@discordjs/voice'
          ? require('../../package.json')
          : miscUtils.__searchPackageJson(
            dirname(require.resolve(name)),
            name,
            8,
          );
      return pkg?.version ?? undefined;
    } catch (err) {
      return undefined;
    }
  }
  /**
   * @private __searchPackageJson() -> Searching Every package.json with deps
   * @param {String} dir Directory name | value
   * @param {String} packageName NPM Package Name
   * @param {Number} depth Depth to go in Directories or outward
   * @returns {Object} pacakge.json file with accurate versions
   */

  static __searchPackageJson(dir, packageName, depth) {
    if (depth === 0) return undefined;
    const attemptedPath = resolve(dir, './package.json');
    try {
      const pkg = require(attemptedPath);
      if (pkg.name !== packageName)
        throw new Error('package.json does not match');
      return pkg;
    } catch (err) {
      return miscUtils.__searchPackageJson(
        resolve(dir, '..'),
        packageName,
        depth - 1,
      );
    }
  }

  static __initialBuildChecks(discordClient, playerInstance) {
    let FmpeggGarbage;
    let LibopusGarbage;
    const MissingDeps = [' '];
    MissingDeps.push(
      '--[ Missing Dependencies from package.json | Do - "npm i packageName" ]--',
    );
    try {
      const GarbageInfo = FFmpeg.getInfo();
      FmpeggGarbage = !!`- version: ${GarbageInfo.version}`;
      LibopusGarbage = !!`- libopus: ${
        GarbageInfo.output.includes('--enable-libopus') ? 'yes' : 'no'
      }`;
    } catch (err) {
      LibopusGarbage = FmpeggGarbage = undefined;
    }
    !miscUtils.scanDeps('@discordjs/voice')
      ? MissingDeps.push(`${MissingDeps.length - 1})  "@discordjs/voice"`)
      : undefined;
    !miscUtils.scanDeps('prism-media')
      ? MissingDeps.push(`${MissingDeps.length - 1})  "prism-media"`)
      : undefined;

    !miscUtils.scanDeps('@discordjs/opus') &amp;&amp; !miscUtils.scanDeps('opusscript')
      ? MissingDeps.push(
        `${MissingDeps.length - 1})  "@discordjs/opus" OR "opusscript"`,
      )
      : undefined;

    !miscUtils.scanDeps('tweetnacl') &amp;&amp;
    !(miscUtils.scanDeps('libsodium-wrapper') &amp;&amp; miscUtils.scanDeps('sodium'))
      ? MissingDeps.push(
        `${
          MissingDeps.length - 1
        })  "tweetnacl" OR ("libsodium-wrapper" And "sodium")`,
      )
      : undefined;

    !miscUtils.scanDeps('ffmpeg-static') &amp;&amp; !(LibopusGarbage &amp;&amp; FmpeggGarbage)
      ? MissingDeps.push(
        `${
          MissingDeps.length - 1
        })  "ffmpeg-static" OR "Ffmpeg from [https://www.ffmpeg.org/download.html]"`,
      )
      : undefined;

    !miscUtils.scanDeps('playdl-music-extractor') &amp;&amp;
    !miscUtils.scanDeps('video-extractor')
      ? MissingDeps.push(
        `${
          MissingDeps.length - 1
        })  "playdl-music-extractor" OR "video-extractor"`,
      )
      : undefined;
    if (MissingDeps[2]) {
      setTimeout(() => {
        playerInstance.emit(
          'error',
          playerInstance,
          new Error(
            [
              '-'.repeat(50),
              ...MissingDeps,
              '--[ queue value will be undefined By-default as it will trigger as ->  player.on("error",errorMessage) => {} ]--',
              '-'.repeat(50),
            ].join('\n'),
          ),
          { discordClient },
          'miscUtils.#__initialBuildChecks()',
        );
      }, 2 * 1000);
    }
    if (
      !(
        discordClient &amp;&amp;
        discordClient instanceof Client &amp;&amp;
        discordClient?.user?.id
      )
    ) {
      throw Error(
        'Invalid Discord Client has been Detected! | And get some Voice and Channel Intents too',
      );
    } else if (
      !discordClient.options.intents.has(
        IntentsBitField.Flags.GuildVoiceStates,
      ) &amp;&amp;
      !discordClient.options.intents.has(IntentsBitField.Flags.Guilds)
    ) {
      throw SyntaxError(
        'Missing Intents in Discord Client\n - IntentsBitField.Flags.GuildVoiceStates\n - - IntentsBitField.Flags.Guilds',
      );
    } else if (
      !discordClient.options.intents.has(IntentsBitField.Flags.GuildVoiceStates)
    ) {
      throw SyntaxError(
        'Missing Intents in Discord Client\n - IntentsBitField.Flags.GuildVoiceStates',
      );
    } else if (
      !discordClient.options.intents.has(IntentsBitField.Flags.Guilds)
    ) {
      throw SyntaxError(
        'Missing Intents in Discord Client\n -IntentsBitField.Flags.Guilds',
      );
    } else return undefined;
  }

  /**
   * @static
   * Wait for Milliseconds for Delay between processes
   * @param {Number|String|void} Milliseconds Time in Milliseconds
   * @returns {Promise&lt;void>} return undefined for no return
   */
  static async TimeWait(Milliseconds = 1000) {
    return await new Promise((resolve) => setTimeout(resolve, Number(Milliseconds)));
  }

  /**
   * @static
   * Checks for Valid Url and returns Boolean Results
   * @param {String} Url Raw url for Url Checks
   * @return {Promise&lt;Boolean>} returns undefined on completion
   */
  static async isUriCheck(Url) {
    if (!Url || (Url &amp;&amp; typeof Url !== 'string')) {
      return false;
    }
    const ProtocolAndDomainRegEx = /^(?:\w+:)?\/\/(\S+)$/;
    const LocalHostDomainRegEx = /^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/;
    const NonLocalHostDomainRegEx = /^[^\s\.]+\.\S{2,}$/;
    const SearchMatchResults = Url.match(ProtocolAndDomainRegEx);
    if (!SearchMatchResults || (SearchMatchResults &amp;&amp; !SearchMatchResults[1])) {
      return false;
    }
    if (
      LocalHostDomainRegEx.test(SearchMatchResults[1]) ||
      NonLocalHostDomainRegEx.test(SearchMatchResults[1])
    ) {
      return true;
    }
    return false;
  }
}

module.exports = miscUtils;
</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu Aug 18 2022 15:07:51 GMT+0000 (Coordinated Universal Time) using <a href="https://github.com/zyrouge/jsdoc-skyceil">Skyceil Theme</a>
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

</body>
</html>
