<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: gen/downloader.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/nav.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/skyceil.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
</head>

<body>

<nav class="navbar">
    <h4><a href="index.html">Home</a></h4><h5 class="no-bottom must-underline">Classes</h5><ul><li><span class="small-icon C">C</span><b><a href="downloader.html">downloader</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="downloader.html#eventEmitter">eventEmitter</a></li><li><span class="small-icon M">M</span><a href="downloader.html#options">options</a></li><li><span class="small-icon M">M</span><a href="downloader.html#packet">packet</a></li><li><span class="small-icon M">M</span><a href="downloader.html#playdl">playdl</a></li><li><span class="small-icon M">M</span><a href="downloader.html#player">player</a></li><li><span class="small-icon M">M</span><a href="downloader.html#queue">queue</a></li></ul></li><li><span class="small-icon C">C</span><b><a href="packets.html">packets</a></b><ul class="has-class-methods"><li><span class="small-icon M">M</span><a href="packets.html#__privateCaches">__privateCaches</a></li><li><span class="small-icon M">M</span><a href="packets.html#audioPlayer">audioPlayer</a></li><li><span class="small-icon M">M</span><a href="packets.html#destroyed">destroyed</a></li><li><span class="small-icon M">M</span><a href="packets.html#downloader">downloader</a></li><li><span class="small-icon M">M</span><a href="packets.html#eventEmitter">eventEmitter</a></li><li><span class="small-icon M">M</span><a href="packets.html#guildId">guildId</a></li><li><span class="small-icon M">M</span><a href="packets.html#options">options</a></li><li><span class="small-icon M">M</span><a href="packets.html#player">player</a></li><li><span class="small-icon M">M</span><a href="packets.html#queue">queue</a></li><li><span class="small-icon M">M</span><a href="packets.html#tracksMetadata">tracksMetadata</a></li><li><span class="small-icon M">M</span><a href="packets.html#type">type</a></li><li><span class="small-icon M">M</span><a href="packets.html#voiceMod">voiceMod</a></li></ul></li><li><span class="small-icon C">C</span><a href="player%2520-_%2520Player%2520Class%2520for%2520Discord%2520Client%2520v14%2520for%2520Jericho-Player%2520Framework.html">player -> Player Class for Discord Client v14 for Jericho-Player Framework</a></li><li><span class="small-icon C">C</span><b><a href="queue.html">queue</a></b><ul class="has-class-methods"><li><span class="small-icon F">F</span><a href="queue.html#clear">clear</a></li><li><span class="small-icon M">M</span><a href="queue.html#current">current</a></li><li><span class="small-icon M">M</span><a href="queue.html#destroyed">destroyed</a></li><li><span class="small-icon M">M</span><a href="queue.html#discordClient">discordClient</a></li><li><span class="small-icon M">M</span><a href="queue.html#eventEmitter">eventEmitter</a></li><li><span class="small-icon M">M</span><a href="queue.html#guildId">guildId</a></li><li><span class="small-icon M">M</span><a href="queue.html#options">options</a></li><li><span class="small-icon M">M</span><a href="queue.html#packet">packet</a></li><li><span class="small-icon M">M</span><a href="queue.html#paused">paused</a></li><li><span class="small-icon M">M</span><a href="queue.html#player">player</a></li><li><span class="small-icon M">M</span><a href="queue.html#playing">playing</a></li><li><span class="small-icon M">M</span><a href="queue.html#previousTrack">previousTrack</a></li><li><span class="small-icon M">M</span><a href="queue.html#previousTracks">previousTracks</a></li><li><span class="small-icon M">M</span><a href="queue.html#timeStamps">timeStamps</a></li><li><span class="small-icon M">M</span><a href="queue.html#tracks">tracks</a></li><li><span class="small-icon M">M</span><a href="queue.html#voiceConnection">voiceConnection</a></li><li><span class="small-icon M">M</span><a href="queue.html#voiceMod">voiceMod</a></li><li><span class="small-icon M">M</span><a href="queue.html#volume">volume</a></li><li><span class="small-icon M">M</span><a href="queue.html#working">working</a></li></ul></li><li><span class="small-icon C">C</span><a href="voiceMod.html">voiceMod</a></li></ul><h4>Global</h4><ul><li><a href="global.html#__cacheAndCleanTracksCacheandCleanTracksonTrackEndeventTrigger/Requirement">__cacheAndCleanTracks Cache and Clean Tracks on Track End event Trigger/Requirement</a></li><li><a href="global.html#__perfectCleanPerfectcleanforavoidingMemoryleakandreleasethetidewithRAMusuage">__perfectClean Perfect clean for avoiding Memory leak and release the tide with RAM usuage</a></li><li><a href="global.html#__playlistModPlaylistModeratorforeventsandparsingrawPlaylist/AlbumData">__playlistMod Playlist Moderator for events and parsing raw Playlist/Album Data</a></li><li><a href="global.html#__queryFilterQueryFilterfortheSongUrlschecks">__queryFilter Query Filter for the Song Urls checks</a></li><li><a href="global.html#__trackMovementManagerTrackMovementAudioResourceandFetchingProperly">__trackMovementManager Track Movement Audio Resource and Fetching Properly</a></li><li><a href="global.html#__tracksModTracksModeratorforeventsandparsingrawTracksDatafromdefaultextractors">__tracksMod Tracks Moderator for events and parsing raw Tracks Data from default extractors</a></li><li><a href="global.html#backBackMethodfortheQueue">back Back Method for the Queue</a></li><li><a href="global.html#createQueueCreationofQueueInstancewithpropercachingandOptionsformulator">createQueue Creation of Queue Instance with proper caching and Options formulator</a></li><li><a href="global.html#depReportDependenciesReportasStringfromthemiscUtils">depReport Dependencies Report as String from the misc Utils</a></li><li><a href="global.html#destroyDestroypacketandinternalworkingsofqueueregister/cachesandwithacompleteclearenceandevenclearbackendcachestoremoveallconnectionsfromeveryrequestorhandlersifany">destroy Destroy packet and internal workings of queue register/caches and with a complete clearence and even clear backend caches to remove all connections from every request or handlers </a></li><li><a href="global.html#destroyQueueDestroyQueuefromPlayerCachesanddestroyQueueinternallyifanyprocessarerunningoronwait">destroyQueue Destroy Queue from Player Caches and destroy Queue internally </a></li><li><a href="global.html#extractorDataManagerextractorDataManagerforthemanupualtingextractorDatafromtheTrack">extractorDataManager extractorDataManager for the manupualting extractorData from the Track</a></li><li><a href="global.html#getGetTracksDataortriggeringtrackeventforTracksMod">get Get Tracks Data or triggering track event for Tracks Mod</a></li><li><a href="global.html#getPlaydlPlay-dlextractorFunctionwithrepsecttointernalfunctionstosupportthecauseofusage">getPlaydl Play-dl extractor Function with repsect to internal functions to support the cause of usage</a></li><li><a href="global.html#getQueryFetchingTracksDataandPlaylistDataRequestfromextractorsusingdownloaderclass">getQuery Fetching Tracks Data and Playlist Data Request from extractors using downloader class</a></li><li><a href="global.html#getQueueFetching/GettingofQueueInstancewithpropercachingandOptionsformulator">getQueue Fetching/Getting of Queue Instance with proper caching and Options formulator</a></li><li><a href="global.html#getYoutubedlYoutube-dlextractorFunctionwithrepsecttointernalfunctionstosupportthecauseofusage">getYoutubedl Youtube-dl extractor Function with repsect to internal functions to support the cause of usage</a></li><li><a href="global.html#muteMutetheMusicPlayeroftheQueue">mute Mute the Music Player of the Queue</a></li><li><a href="global.html#pausePauseAudioPlayeroftheQueue">pause Pause Audio Player of the Queue</a></li><li><a href="global.html#playPlayMethodofQueueClasstoplayrawQueryInfoafterprocessingandfetchfromwebusingextractors">play Play Method of Queue Class to play raw Query Info after processing and fetch from web using extractors</a></li><li><a href="global.html#setVolumeSettingVolumeoftheAudioPlayer">setVolume Setting Volume of the Audio Player</a></li><li><a href="global.html#shuffleShuffleMethodfortheQueue">shuffle Shuffle Method for the Queue</a></li><li><a href="global.html#skipSkippingCurrentTracktospecifiedTrack-Countsorby-defaultonnextsong">skip Skipping Current Track to specified Track-Counts or by-default on next song</a></li><li><a href="global.html#stopStoppingCurrentTrackalongsidewithQueuetoacompletesilencewithcleaning">stop Stopping Current Track along side with Queue to a complete silence with cleaning</a></li><li><a href="global.html#unmuteUn-MutetheMusicPlayeroftheQueue">unmute Un-Mute the Music Player of the Queue</a></li><li><a href="global.html#unpauseUn-PauseAudioPlayeroftheQueue">unpause Un-Pause Audio Player of the Queue</a></li></ul>
</nav>

<div id="main">
    <div class="burger">
        <div class="burger-line-1"></div>
        <div class="burger-line-2"></div>
        <div class="burger-line-3"></div>
    </div>

    <h1 class="page-title">Source: gen/downloader.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { User } = require('discord.js');
const { playdl, playdlQuick } = require('playdl-music-extractor');
const player = require('../core/player');
const queue = require('../core/queue');
const { downloaderOptions } = require('../misc/enums');
const { scanDeps } = require('../utils/miscUtils');
const eventEmitter = require('../utils/eventEmitter');
const packets = require('./packets');

class downloader {
  /**
   * @constructor
   * @param {packets} packet Packet Instance for moderating backend manupulation and request handlers and handle massive functions and events
   * @param {downloaderOptions} options Downloader Options for extractor's scrapping Options
   */
  constructor(packet, options = downloaderOptions) {
    /**
     * Packet Instance for moderating backend manupulation and request handlers and handle massive functions and events
     * @type {packets}
     * @readonly
     */
    this.packet = packet;

    /**
     * Queue data for Guild Moderation with Voice Channels/Connections
     * @type {queue}
     * @readonly
     */
    this.queue = packet?.queue;

    /**
     * Actual Jericho-Player's Class Instance for sup=properties requirements and usage
     * @type {player}
     */
    this.player = packet?.player;

    /**
     * Event Emitters for Error Management and Event Emitting with proper meanings
     * @type {eventEmitter}
     */
    this.eventEmitter = packet?.eventEmitter;

    /**
     * options Downloader Options for extractor's scrapping Options
     * @type {downloaderOptions}
     * @readonly
     */
    this.options = options;

    /**
     * Play-dl Class Instance for making solid and proper tunneled request inter-exchange
     * @type {playdl}
     */
    this.playdl = new playdl(options);

    this.playdl.on('album', (playlist) => (playlist ? this.packet?.__playlistMod(playlist) : undefined));

    this.playdl.on(
      'track',
      async (extractor, playlist, rawTrack, extractorData, metadata) => await this.packet.__tracksMod(extractor, playlist, rawTrack, metadata),
    );
    if (scanDeps('video-extractor')) {
      const { youtubedl } = require('video-extractor');
      this.youtubedl = new youtubedl(options);
      this.youtubedl.on('album', (playlist) => (playlist ? this.packet?.__playlistMod(playlist) : undefined));

      this.youtubedl.on(
        'track',
        async (extractor, playlist, rawTrack, metadata) => await this.packet.__tracksMod(extractor, playlist, rawTrack, metadata),
      );
    }
  }

  /**
   * @method get Get Tracks Data or triggering track event for Tracks Mod
   * @param {string} rawQuery String Value for fetching/Parsing with the help of extractors
   * @param {User} requestedSource requested By Source Data for checks and avoid the further edits on it by some stranger to protect the integrity
   * @param {downloaderOptions} options options Downloader Options for extractor's scrapping Options
   * @returns {Promise&lt;Boolean | undefined>} Returns Raw Extractor Data on completion of processing and extracting
   */
  async get(rawQuery, requestedSource, options = downloaderOptions) {
    if (!(rawQuery &amp;&amp; typeof rawQuery === 'string' &amp;&amp; rawQuery !== ''))
      return undefined;
    else if (options?.extractor?.toLowerCase()?.trim() === 'youtubedl')
      return await this.getYoutubedl(rawQuery, requestedSource, options);
    else return await this.getPlaydl(rawQuery, requestedSource, options);
  }

  /**
   * @method getPlaydl Play-dl extractor Function with repsect to internal functions to support the cause of usage
   * @param {string} rawQuery String Value for fetching/Parsing with the help of extractors
   * @param {User} requestedSource requested By Source Data for checks and avoid the further edits on it by some stranger to protect the integrity
   * @param {downloaderOptions} options options Downloader Options for extractor's scrapping Options
   * @returns {Promise&lt;Boolean | undefined>} Returns Raw Extractor Data on completion of processing and extracting
   */

  async getPlaydl(rawQuery, requestedSource, options = downloaderOptions) {
    this.eventEmitter.emitDebug(
      'playdl - Extractor',
      'Making Request to playdl extractors for parsing and fetch required Track Data',
      {
        rawQuery,
        requestedSource,
        downloaderOptions: options,
      },
    );
    const extractorData = await this.playdl.exec(rawQuery, {
      ...options,
      playersCompatibility: true,
      waitForPromise: false,
      eventReturn: {
        ...options?.eventReturn,
        metadata: {
          ...options?.eventReturn?.metadata,
          __privateCaches: { downloaderOptions: options, requestedSource },
        },
      },
      streamDownload: true,
    });
    extractorData.on('tracks', (tracks, playlist, metadata) => this.packet.extractorDataManager(
      { rawTracks: tracks, playlist },
      'parseTracks',
    ));
    return true;
  }

  /**
   * @method getYoutubedl Youtube-dl extractor Function with repsect to internal functions to support the cause of usage
   * @param {string} rawQuery String Value for fetching/Parsing with the help of extractors
   * @param {User} requestedSource requested By Source Data for checks and avoid the further edits on it by some stranger to protect the integrity
   * @param {downloaderOptions} options options Downloader Options for extractor's scrapping Options
   * @returns {Promise&lt;Boolean | undefined>} Returns Raw Extractor Data on completion of processing and extracting
   */

  async getYoutubedl(rawQuery, requestedSource, options = downloaderOptions) {
    this.eventEmitter.emitDebug(
      'youtubedl - Extractor',
      'Making Request to youtubedl extractors for parsing and fetch required Track Data',
      {
        rawQuery,
        requestedSource,
        downloaderOptions: options,
      },
    );
    let extractorData = await this.youtubedl.exec(rawQuery, {
      ...options,
      playersCompatibility: true,
      waitForPromise: false,
      eventReturn: {
        ...options?.eventReturn,
        metadata: {
          ...options?.eventReturn?.metadata,
          __privateCaches: { downloaderOptions: options, requestedSource },
        },
      },
      streamDownload: true,
    });
    if (!extractorData?.tracks) {
      extractorData = await this.playdl.exec(rawQuery, {
        ...options,
        playersCompatibility: true,
        waitForPromise: false,
        eventReturn: {
          ...options?.eventReturn,
          metadata: {
            ...options?.eventReturn?.metadata,
            __privateCaches: { downloaderOptions: options, requestedSource },
          },
        },
        streamDownload: true,
      });
    } else return undefined;
    extractorData.on('tracks', (tracks, playlist, metadata) => this.packet.extractorDataManager(
      { rawTracks: tracks, playlist },
      'parseTracks',
    ));
    return true;
  }

  static async getNonEventExtractor(
    rawQuery,
    metadataCaches = {},
    options = downloaderOptions,
  ) {
    if (!(rawQuery &amp;&amp; typeof rawQuery === 'string' &amp;&amp; rawQuery !== ''))
      return undefined;
    else if (
      options?.extractor?.toLowerCase()?.trim() === 'youtubedl' &amp;&amp;
      scanDeps('video-extractor')
    ) {
      const { youtubedlQuick } = require('video-extractor');
      return await youtubedlQuick.exec(rawQuery, {
        ...options,
        playersCompatibility: true,
        eventReturn: {
          ...options?.eventReturn,
          metadata: {
            ...options?.eventReturn?.metadata,
            __privateCaches: { ...metadataCaches, downloaderOptions: options },
          },
        },
        streamDownload: true,
      });
    } else
      return await playdlQuick.exec(rawQuery, {
        ...options,
        playersCompatibility: true,
        eventReturn: {
          ...options?.eventReturn,
          metadata: {
            ...options?.eventReturn?.metadata,
            __privateCaches: { ...metadataCaches, downloaderOptions: options },
          },
        },
        streamDownload: true,
      });
  }

  /**
   * @method __queryFilter Query Filter for the Song Urls checks
   * @param {String[]} fitlers Query checking Filters from the User
   * @returns {Boolean | false} Returns Boolean value as true
   */

  __queryFilter(rawQuery, filters = ['all']) {
    if (!(rawQuery &amp;&amp; typeof rawQuery === 'string' &amp;&amp; rawQuery !== ''))
      return undefined;
    const isValidUrl = (urlString) => {
      try {
        return Boolean(new URL(urlString));
      } catch (e) {
        return false;
      }
    };
    const isValidYoutube = (url) => {
      const p =
        /^(?:https?:\/\/)?(?:m\.|www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&amp;v=))((\w|-){11})(?:\S+)?$/;
      return Boolean(url.match(p)?.[1]);
    };
    const isValidSpotify = (url) => {
      const p =
        /^(?:spotify:|(?:https?:\/\/(?:open|play)\.spotify\.com\/))(?:embed)?\/?(album|podcasts|track)(?::|\/)((?:[0-9a-zA-Z]){22})/;
    };
    if (filters?.includes('all')) return true;
    else if (filters?.includes('query') &amp;&amp; !isValidUrl(rawQuery)) return true;
    else if (
      filters?.includes('youtube') &amp;&amp;
      isValidUrl(rawQuery) &amp;&amp;
      isValidYoutube(rawQuery)
    )
      return true;
    else if (
      filters?.includes('spotify') &amp;&amp;
      isValidUrl(rawQuery) &amp;&amp;
      isValidSpotify(rawQuery)
    )
      return true;
    else return false;
  }
}

module.exports = downloader;
</code></pre>
        </article>
    </section>





</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Mon Aug 22 2022 08:00:07 GMT+0000 (Coordinated Universal Time) using <a href="https://github.com/zyrouge/jsdoc-skyceil">Skyceil Theme</a>
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

</body>
</html>
